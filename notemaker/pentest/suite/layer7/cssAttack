#!/bin/bash
echo
echo "-----------   CROSS SITE SCRIPTING ATTACK ---------------"

websvc=$(kubectl get svc -n notemaker | grep LoadBalancer | grep nginx | awk '{ print $4 }')
[[ -z $websvc ]] && echo "Problem determining URL for web service, exiting!" && exit

echo "------ launching CSS attack on http://$websvc "

curl -s -o responses/css-response.html -d "<body onload=alert('test1')>" http://$websvc
success=$(grep -c POST responses/css-response.html)

if [ "$success" == "1" ]; then
  echo "   >> CSS attack succeeded"
  echo "!-------- CROSS SITE SCRIPTING ATTACK SUCCESSFUL --------"
else
  echo "   >> CSS attack prevented"
  echo "---- open css-response.html in browser to see result ----"
  echo "--------- CROSS SITE SCRIPTING ATTACK FAILED ------------"
fi
echo



